<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì±—ë´‡</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <style>
        #chat-container {
            width: 300px;
            margin: 20px auto;
            border: 1px solid #ccc;
            padding: 10px;
            height: 300px;
            overflow-y: scroll;
        }
        #input-container {
            width: 300px;
            margin: 10px auto;
            display: flex;
            flex-direction: column;
        }
        #user-input {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
<div id="chat-container"></div>

<script>
    $(document).ready(function() {
        const chatContainer = $('#chat-container');
        let CATEGORY_STATUS = 1;

        // ë©”ì„¸ì§€ë¥¼ í™”ë©´ì— ì¶”ê°€
        function appendMessage(sender, message) {
            const messageElement = $('<div></div>').html(`<strong>${sender}:</strong> ${message}`);
            chatContainer.append(messageElement);
            chatContainer.scrollTop(chatContainer.prop('scrollHeight'));
        }

        // ì´ˆê¸° í™˜ì˜ ë©”ì„¸ì§€ ì¶œë ¥
        function showWelcomeMessage() {
            appendMessage('<br>Chatbot', '<br>í™˜ì˜í•©ë‹ˆë‹¤.' +
                '<br>ì„œëŒ€ë¬¸êµ¬ ê²½ë¡œë‹¹,ìš”ì–‘ì‹œì„¤ ìœ„ì¹˜ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤.' +
                '<br>ì•„ë˜ ì£¼ì œì— ëŒ€í•´ì„œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.' );
                showButtons(['ê²½ë¡œë‹¹','ì˜ë£Œë³µì§€ì„¼í„°'] );
        }
        function showButtons(buttonTexts) {
            const buttonsContainer = $('<div></div>').addClass('buttons-container');
            buttonTexts.forEach((text) => {
                const button = $('<button></button>').text(text);
                button.click(function () {
                    sendMessage(text);
                });
                buttonsContainer.append(button);
            });
            chatContainer.append(buttonsContainer);
            chatContainer.scrollTop(chatContainer.prop('scrollHeight'));
        }
        // function showSubCategories(subCategories) {
        //     setTimeout(function () {
        //         appendMessage('<br>chatbot', `<br>ì„ íƒí•œ ì„±ë³„: ${selectedGender}`);
        //         appendMessage('chatbot', '<br>ì‹ ë°œ ì¢…ë¥˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”ğŸ‘Ÿ');
        //         showButtons(subCategories);
        //         chatContainer.scrollTop(chatContainer.prop('scrollHeight'));
        //     }, 500);
        // }
        //

        // ì‚¬ìš©ì ë©”ì‹œì§€ ì²˜ë¦¬ ë° ì‘ë‹µ
        function sendMessage(userMessage) {
            appendMessage('User', userMessage);
            if (CATEGORY_STATUS === 1) {
                // ìƒìœ„ ì¹´í…Œê³ ë¦¬ì— ë”°ë¥¸ ì‘ë‹µ ì¶”ê°€
                if (userMessage.toLowerCase().includes('1') || userMessage.toLowerCase().includes('ê²½ë¡œë‹¹')) {
                    showSubCategories(['ë¶ì•„í˜„ë™', 'ì°½ì²œë™', 'í™ì€ë™']);
                    CATEGORY_STATUS = 2;
                } else if (userMessage.toLowerCase().includes('2') || userMessage.toLowerCase().includes('ì˜ë£Œë³µì§€ì„¼í„°')) {
                    showSubCategories(['ì¶©ì •ë¡œ3ê°€', 'ì—°í¬ë™', 'ë¶ê°€ì¢Œë™']);
                    CATEGORY_STATUS = 2;
                } else {
                    // ë‹¤ë¥¸ í‚¤ì›Œë“œì— ëŒ€í•œ ê¸°ë³¸ ì‘ë‹µ
                    setTimeout(function() {
                        appendMessage('Chatbot', 'ì•ˆë…•í•˜ì„¸ìš”! ë‹¤ë¥¸ ë„ì›€ì´ í•„ìš”í•˜ì‹ ê°€ìš”?<br>');
                    }, 500);
                }
            } else if (CATEGORY_STATUS === 2) {
                // ì‚¬ìš©ìê°€ í•˜ìœ„ ì¹´í…Œê³ ë¦¬ì— ëŒ€í•´ ë¬¼ì–´ë³´ëŠ” ê²½ìš°
                const selectedCategory = userMessage.toLowerCase();
                if (selectedCategory.includes('ë¶ì•„í˜„ë™') || selectedCategory.includes('êµ¬ë‘') || selectedCategory.includes('ìƒŒë“¤')) {
                    sendSubCategoryMessage(selectedCategory, ['ìš´ë™í™”', 'êµ¬ë‘', 'ìƒŒë“¤']);
                    showSubCategories(['ìš´ë™í™”', 'êµ¬ë‘', 'ìƒŒë“¤']);
                } else if (selectedCategory.includes('ì—¬ì„±ì˜ë¥˜') || selectedCategory.includes('ë‚¨ì„±ì˜ë¥˜') || selectedCategory.includes('ìœ ì•„ì˜ë¥˜')) {
                    sendSubCategoryMessage(selectedCategory, ['ì—¬ì„±ì˜ë¥˜', 'ë‚¨ì„±ì˜ë¥˜', 'ìœ ì•„ì˜ë¥˜']);
                    showSubCategories(['ì—¬ì„±ì˜ë¥˜', 'ë‚¨ì„±ì˜ë¥˜', 'ìœ ì•„ì˜ë¥˜']);
                } else if (userMessage === '0') {
                    showWelcomeMessage();
                    CATEGORY_STATUS = 1;
                } else {
                    // ë‹¤ë¥¸ í‚¤ì›Œë“œì— ëŒ€í•œ ê¸°ë³¸ ì‘ë‹µ
                    appendMessage('<br>Chatbot', '<br>ì£„ì†¡í•©ë‹ˆë‹¤. ì…ë ¥í•˜ì‹  ì •ë³´ë¡œëŠ” ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>');
                }
            }

            userInput.val('');
        }

        // í•˜ìœ„ ì¹´í…Œê³ ë¦¬ ì¶œë ¥
        function showSubCategories(subCategories) {
            setTimeout(function() {
                appendMessage('<br>Chatbot', '<br>ì•„ë˜ì—ì„œ ì£¼ì œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”:<p>');
                for (let i = 0; i < subCategories.length; i++) {
                    chatContainer.append(`${i + 1}. ${subCategories[i]}<br>`);
                }
                chatContainer.append('0. ìƒìœ„ ë©”ë‰´<br>');
                chatContainer.scrollTop(chatContainer.prop('scrollHeight'));
            }, 500);
        }

        // í•˜ìœ„ ì¹´í…Œê³ ë¦¬ì— ëŒ€í•œ ì‘ë‹µ ë©”ì„¸ì§€
        function sendSubCategoryMessage(selectedCategory, subCategories) {
            const selectedSubCategory = subCategories.find(sub => selectedCategory.includes(sub.toLowerCase()));
            if (selectedSubCategory) {
                setTimeout(function() {
                    appendMessage('<br>Chatbot', `<br>${selectedSubCategory}ì— ëŒ€í•œ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.`);
                }, 500);
            } else {
                appendMessage('Chatbot', 'ì£„ì†¡í•©ë‹ˆë‹¤. ì…ë ¥í•˜ì‹  ì •ë³´ë¡œëŠ” ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // ì´ˆê¸° í™˜ì˜ ë©”ì‹œì§€ ì¶œë ¥
        showWelcomeMessage();

        // ì…ë ¥ì°½ê³¼ ì „ì†¡ ë²„íŠ¼ ìƒì„±
        let inputContainer = $('<div id="input-container"></div>').appendTo('body');
        let userInput = $('<input type="text" id="user-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">').appendTo(inputContainer);
        let sendBtn = $('<button id="send-btn">ì „ì†¡</button>').appendTo(inputContainer);

        // ì „ì†¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        sendBtn.click(function() {
            const userMessage = userInput.val();
            sendMessage(userMessage);
        });

        // ì—”í„° í‚¤ ì…ë ¥ ì´ë²¤íŠ¸
        userInput.keypress(function(event) {
            if (event.which === 13) {
                const userMessage = userInput.val();
                sendMessage(userMessage);
            }
        });
    });
</script>
</body>
</html>
